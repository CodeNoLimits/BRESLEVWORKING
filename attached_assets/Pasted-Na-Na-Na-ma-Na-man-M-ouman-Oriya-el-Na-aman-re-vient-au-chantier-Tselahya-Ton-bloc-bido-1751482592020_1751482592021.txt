Na Naá¸¥ Naá¸¥ma Naá¸¥man MÃ©ouman ğŸ•Šï¸

**Oriyaâ€™el Naâ€™aman** re-vient au chantier, Tselahya.
Ton â€œbloc bidonâ€ rÃ©-apparaÃ®t parce quâ€™il est gÃ©nÃ©rÃ© **Ã  deux moments diffÃ©rents** :

1. par lâ€™API quand tu cliques sur un bouton (â€œAnalyser ce texteâ€, â€œGuidanceâ€â€¦) ;
2. par le composant dâ€™affichage qui considÃ¨re encore â€œguidanceâ€ comme un rÃ´le normal.

On lâ€™extermine une bonne fois pour toutes.

---

## 1 Â· Couper la racine : ne plus renvoyer ce bloc depuis le serveur

### `server/routes/ask.ts` (ou `/guidance.ts`)

```ts
const system = `
Tu es un Ã©rudit de Rabbi Na'hman.
â–º TU DOIS rÃ©pondre **en franÃ§ais uniquement**.
â–º TU NE dois PAS inclure le contexte, ni rÃ©sumer le passage original.
â–º Contente-toi de la rÃ©ponse, claire, structurÃ©e, avec les rÃ©fÃ©rences (Livre â€“ Â§).
`;
â€¦
const reply = await model.generateContent({ â€¦, systemInstruction: system });
const answer = reply.response.text().trim();

/* <<<  SUPPRIME COMPLETEMENT  >>>
res.json({ context, answer });     
*/

/*  >>>  GARDE SEULEMENT LA REPONSE  <<<  */
res.json({ answer });
```

* **Important** : supprime toute clÃ© `context`, `guidance`, `analysis`, etc.
* Recharge le serveur â†’ teste : le JSON ne contient plus que `{answer:"â€¦"}`.

---

## 2 Â· Filtrer ce qui resterait cÃ´tÃ© front-end (ceinture & bretelles)

### `client/src/components/ChatMessage.tsx`

```tsx
// Nâ€™affiche rien si le rÃ´le est "guidance" ou si le texte commence par "GUIDANCE SPIRITUELLE"
if (role === "guidance" || text.startsWith("GUIDANCE SPIRITUELLE")) return null;
```

### `client/src/components/AnswerPanel.tsx`

```tsx
// Avant dâ€™afficher :
const clean = answer
  .replace(/^GUIDANCE[^\n]+\n+/i, "")   // zappe le header FranÃ§ais/Anglais rÃ©sidu
  .replace(/^Know![\s\S]+?Likewise,[\s\S]+?$/i, ""); // zappe Ã©ventuel parag. anglais
```

---

## 3 Â· VÃ©rifier (3 clics)

1. **Run** dans Replit.
2. Pose une question : le bloc bleu clair nâ€™apparaÃ®t plus.
3. Clique â€œAnalyser ce texteâ€ â†’ mÃªme rÃ©sultat : seulement la rÃ©ponse en FR.

---

## 4 Â· Commit & push

```bash
git add server/routes/ask.ts \
        client/src/components/ChatMessage.tsx \
        client/src/components/AnswerPanel.tsx
git commit -m "fix(ui+api): supprime dÃ©finitivement le bloc contexte anglais"
git push
```

GitHub Desktop : **Commit** â†’ **Push** â†’ la PR se met Ã  jour â†’ **Merge**.

---

### Si par hasard le bloc revient encore

* Vide le cache du navigateur (ou ouvre en mode Incognito).
* VÃ©rifie lâ€™onglet **Network** : la rÃ©ponse JSON **ne doit plus contenir** autre chose que `answer`.
* Sâ€™il subsiste un autre endpoint (ex. `/analyse`, `/points`) rÃ©pÃ¨te la mÃªme opÃ©ration : supprimer le retour de `context`.

---

Dis-moi quand câ€™est clean sur ton Ã©cran ; on passera alors au micro STT si besoin dâ€™affiner encore.

Na Naá¸¥ Naá¸¥ma Naá¸¥man MÃ©ouman ğŸŒŸ
